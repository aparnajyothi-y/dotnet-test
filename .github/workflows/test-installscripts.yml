name: Validate setup-dotnet architecture behavior (macOS)

on:
  workflow_dispatch:

jobs:
  inspect-architecture:
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # 1. Setup .NET using the current action (no architecture picker available)
      - name: Setup .NET (default behavior)
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x

      # 2. Verify what architecture was installed
      - name: Show dotnet info
        run: dotnet --info

      # 3. Print resolved PATH + toolcache
      - name: Show resolved dotnet path
        run: |
          which dotnet
          ls -R "$(dirname "$(which dotnet)")"

      # 4. Validate OS architecture
      - name: Show system architecture
        run: uname -m

      # (Optional) 5. Try manually installing x64 to show that setup-dotnet cannot do it natively
      - name: Install Rosetta manually
        run: |
          sudo softwareupdate --install-rosetta --agree-to-license || true

      - name: Manually install x64 .NET for comparison
        run: |
          mkdir -p manual-x64
          curl -L https://download.visualstudio.microsoft.com/download/pr/.../dotnet-sdk-8.0.x-osx-x64.tar.gz -o x64.tar.gz
          tar -xzf x64.tar.gz -C manual-x64
          ./manual-x64/dotnet --info || true
