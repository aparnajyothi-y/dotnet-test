name: windows-arch-validation

on:
  workflow_dispatch:

jobs:
  validate-architectures:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET SDK (native x64)
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.x

      - name: Print native x64 .NET SDK info
        run: |
          echo "=== Windows native x64 dotnet (setup-dotnet default) ==="
          dotnet --info

      - name: Manual x64 install (explicit)
        run: |
          curl -sSL https://dot.net/v1/dotnet-install.ps1 -o dotnet-install.ps1
          powershell -ExecutionPolicy Bypass -File dotnet-install.ps1 -Runtime dotnet -Version 8.0.416 -Architecture x64 -InstallDir $env:USERPROFILE\.dotnet-x64
          echo "=== x64 dotnet (manual install) ==="
          & "$env:USERPROFILE\.dotnet-x64\dotnet" --info

      - name: Manual ARM64 install (will fail to execute)
        run: |
          curl -sSL https://dot.net/v1/dotnet-install.ps1 -o dotnet-install.ps1
          powershell -ExecutionPolicy Bypass -File dotnet-install.ps1 -Runtime dotnet -Version 8.0.416 -Architecture arm64 -InstallDir $env:USERPROFILE\.dotnet-arm64
          echo "=== ARM64 dotnet (manual install, expected to fail on x64 Windows) ==="
          & "$env:USERPROFILE\.dotnet-arm64\dotnet" --info || echo "ARM64 binaries cannot run on x64 Windows runners"
